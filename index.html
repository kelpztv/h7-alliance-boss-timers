<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>H7 Alliance Boss Timer</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body style="background:#111;color:white;font-family:sans-serif;">
  <div id="root"></div>

  <script type="text/babel">

    const { useState, useEffect, useMemo } = React;

    function BossTimerApp() {
      const defaultBosses = [
        { name: "Dark Reaper", respawn: 180 },
        { name: "Night Stalker", respawn: 2700 },
        { name: "Hell Beast", respawn: 3600 }
      ];

      const channel = useMemo(() => new BroadcastChannel("h7-boss-sync"), []);

      const [bosses, setBosses] = useState(() => JSON.parse(localStorage.getItem("bosses")) || defaultBosses);
      const [kills, setKills] = useState(() => JSON.parse(localStorage.getItem("kills") || "{}"));

      useEffect(() => {
        localStorage.setItem("bosses", JSON.stringify(bosses));
        channel.postMessage({ bosses });
      }, [bosses]);

      useEffect(() => {
        localStorage.setItem("kills", JSON.stringify(kills));
        channel.postMessage({ kills });
      }, [kills]);

      useEffect(() => {
        channel.onmessage = ({ data }) => {
          if (data.bosses) setBosses(data.bosses);
          if (data.kills) setKills(data.kills);
        };
      }, []);

      function start(name) {
        setKills(prev => ({ ...prev, [name]: Date.now() }));
      }

      function fmt(sec) {
        const m = Math.floor(sec / 60);
        const s = sec % 60;
        return `${m}m ${s}s`;
      }

      function addBoss() {
        const name = prompt("Boss name");
        const respawn = parseInt(prompt("Respawn minutes")) * 60;
        setBosses(prev => [...prev, { name, respawn }]);
      }

      return (
        <div>
          <h1>H7 Alliance Boss Timer</h1>
          <button onClick={addBoss}>Add Boss</button>

          {bosses.map(b => {
            const last = kills[b.name];
            const remain = last ? Math.max(0, Math.floor((last + b.respawn*1000 - Date.now())/1000)) : null;
            return (
              <div key={b.name}>
                <b>{b.name}</b><br/>
                {remain !== null ? `Next in ${fmt(remain)}` : "No timer running"}<br/>
                <button onClick={() => start(b.name)}>{remain===0 ? "Ready" : "Start"}</button>
                <hr/>
              </div>
            );
          })}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<BossTimerApp />);

  </script>
</body>
</html>

